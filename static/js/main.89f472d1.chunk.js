(this["webpackJsonpclubhouse-csv-upload"]=this["webpackJsonpclubhouse-csv-upload"]||[]).push([[0],{231:function(e,t,n){},233:function(e,t,n){},467:function(e,t,n){"use strict";n.r(t);var r=n(9),a=n(0),c=n.n(a),s=n(20),i=n.n(s),o=(n(231),n(31)),u=(n(232),n(233),n(16)),l=n.n(u),h=n(33),p=n(77),b=n(78),j=function(){function e(t){Object(p.a)(this,e),this.clubhouseToken=void 0,this.headers=void 0,this.epics=void 0,this.iterations=void 0,this.milestones=void 0,this.projects=void 0,this.workflows=void 0,this.members=void 0,this.clubhouseToken=t,this.headers={"Content-Type":"application/json","Clubhouse-Token":this.clubhouseToken},this.epics=[],this.iterations=[],this.milestones=[],this.projects=[],this.workflows=[],this.members=[]}return Object(b.a)(e,[{key:"getRequest",value:function(){var e=Object(h.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{headers:this.headers,method:"get"});case 3:if(!0!==(null===(n=e.sent)||void 0===n?void 0:n.ok)){e.next=10;break}return e.next=7,n.json();case 7:return e.abrupt("return",e.sent);case 10:return e.abrupt("return",n);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"postRequest",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{headers:this.headers,method:"post",body:JSON.stringify(n)});case 3:if(!0!==(null===(r=e.sent)||void 0===r?void 0:r.ok)){e.next=10;break}return e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 10:return e.abrupt("return",r);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getEpics",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&!(this.epics.length<=0)){e.next=5;break}return e.next=4,this.getRequest("https://api.clubhouse.io/api/v3/epics");case 4:this.epics=e.sent;case 5:return e.abrupt("return",this.epics);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getIterations",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&!(this.iterations.length<=0)){e.next=5;break}return e.next=4,this.getRequest("https://api.clubhouse.io/api/v3/iterations");case 4:this.iterations=e.sent;case 5:return e.abrupt("return",this.iterations);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMilestones",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&!(this.milestones.length<=0)){e.next=5;break}return e.next=4,this.getRequest("https://api.clubhouse.io/api/v3/milestones");case 4:this.milestones=e.sent;case 5:return e.abrupt("return",this.milestones);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProjects",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&!(this.projects.length<=0)){e.next=5;break}return e.next=4,this.getRequest("https://api.clubhouse.io/api/v3/projects");case 4:this.projects=e.sent;case 5:return e.abrupt("return",this.projects);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWorkflows",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&!(this.workflows.length<=0)){e.next=5;break}return e.next=4,this.getRequest("https://api.clubhouse.io/api/v3/workflows");case 4:this.workflows=e.sent;case 5:return e.abrupt("return",this.workflows);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&!(this.members.length<=0)){e.next=5;break}return e.next=4,this.getRequest("https://api.clubhouse.io/api/v3/members");case 4:this.members=e.sent;case 5:return e.abrupt("return",this.members);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createStories",value:function(e){return this.postRequest("https://api.clubhouse.io/api/v3/stories/bulk",{stories:e})}}]),e}(),d=function(){function e(){Object(p.a)(this,e)}return Object(b.a)(e,[{key:"parseCSV",value:function(e){for(var t=[],n=e.split("\n"),r=1;r<n.length;r++)t.push(n[r].split(","));return this.CSVToArray(e).slice(1)}},{key:"CSVToArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),r=[[]],a=n.exec(e);a;){var c,s=a[1];s.length&&s!==t&&r.push([]),c=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],r[r.length-1].push(c),a=n.exec(e)}return r}}]),e}(),f=function(){function e(){Object(p.a)(this,e),this.reader=void 0,this.reader=new FileReader}return Object(b.a)(e,[{key:"getFileContent",value:function(e){var t=this;return new Promise((function(n,r){t.reader.onload=function(e){var t,r=null===(t=e.target)||void 0===t?void 0:t.result;n(r)};try{t.reader.readAsBinaryString(e)}catch(a){r(a)}}))}}]),e}(),v=c.a.createContext({clubhouseService:new j(""),fileService:new f,csvService:new d,setClubhouseApiToken:function(e){}}),O=n(478),x=n(95),g=n(204),m=n(221),y=n(475);function S(){var e=Object(g.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n"]);return S=function(){return e},e}var k=y.a.Title,w=y.a.Paragraph,C=function(){var e=Object(a.useContext)(v).setClubhouseApiToken;return Object(r.jsxs)(y.a,{children:[Object(r.jsxs)(T,{children:[Object(r.jsx)(k,{children:"Clubhouse CSV Importer"}),Object(r.jsx)(x.a,{onClick:function(){return e("")},type:"ghost",children:"Remove API Token"})]}),Object(r.jsx)(w,{children:"To import a csv file to clubhouse you need to select a milestone, select an epic and after that upload a csv file with the stories"})]})},T=m.a.div(S()),_=n(32),I=n(224),A=n(473),R=n(106),F=n.n(R),P=function(e){var t=e.dataSource,n=e.filterFunction,a=Object(I.a)(e,["dataSource","filterFunction"]),c=n?t.filter(n):t;return Object(r.jsx)(F.a,Object(_.a)(Object(_.a)({},a),{},{notFoundContent:t.length<=0?Object(r.jsx)(A.a,{size:"small"}):null,showSearch:!0,style:{width:300},filterOption:function(e,t){return(null===t||void 0===t?void 0:t.children.toLowerCase().indexOf(e.toLowerCase()))>=0},children:c.map((function(e){return Object(r.jsx)("option",{value:e.id,children:e.name},e.id)}))}))},E=function(e){var t=e.onChange,n=Object(a.useContext)(v).clubhouseService,c=Object(a.useState)([]),s=Object(o.a)(c,2),i=s[0],u=s[1],p=function(){var e=Object(h.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getMilestones();case 2:t=e.sent,u(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(P,Object(_.a)(Object(_.a)({},{onFocus:p,onChange:t}),{},{dataSource:i,placeholder:"Select a milestone"}))},V=function(e){var t=e.onChange,n=Object(a.useContext)(v).clubhouseService,c=Object(a.useState)([]),s=Object(o.a)(c,2),i=s[0],u=s[1],p=function(){var e=Object(h.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getProjects();case 2:t=e.sent,u(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(P,Object(_.a)(Object(_.a)({},{onFocus:p,onChange:t}),{},{dataSource:i,placeholder:"Select a project"}))},q=function(e){var t=e.onChange,n=e.selectedMilestoneId,c=Object(a.useContext)(v).clubhouseService,s=Object(a.useState)([]),i=Object(o.a)(s,2),u=i[0],p=i[1],b=function(){var e=Object(h.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=p,e.next=3,c.getEpics();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(P,Object(_.a)(Object(_.a)({},{onFocus:b,onChange:t,filterFunction:function(e){return e.milestone_id===n}}),{},{disabled:!n,dataSource:u,placeholder:"Select a epic"}))},B=function(e){var t=e.onChange,n=Object(a.useContext)(v).clubhouseService,c=Object(a.useState)([]),s=Object(o.a)(c,2),i=s[0],u=s[1],p=function(){var e=Object(h.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getIterations();case 2:t=e.sent,u(t.sort((function(e,t){return e.created_at<t.created_at?1:e.created_at>t.created_at?-1:0})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(P,Object(_.a)(Object(_.a)({},{onFocus:p,onChange:t}),{},{dataSource:i,placeholder:"Select a iteration"}))},U=function(e){var t=e.onChange,n=Object(a.useContext)(v).clubhouseService,c=Object(a.useState)([]),s=Object(o.a)(c,2),i=s[0],u=s[1],p=function(){var e=Object(h.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getMembers();case 2:t=e.sent,u(t.filter((function(e){return!e.disabled})).sort((function(e,t){return e.profile.name>t.profile.name?1:e.profile.name<t.profile.name?-1:0})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(P,Object(_.a)(Object(_.a)({},{onFocus:p,onChange:t}),{},{dataSource:i.map((function(e){return Object(_.a)(Object(_.a)({},e),{},{name:e.profile.name})})),placeholder:"Select a member"}))},D=function(e){var t=e.onChange,n=e.projectId,c=Object(a.useContext)(v).clubhouseService,s=Object(a.useState)([]),i=Object(o.a)(s,2),u=i[0],p=i[1],b=function(){var e=Object(h.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.getWorkflows();case 2:t=e.sent,n&&1===(r=t.filter((function(e){return e.project_ids.indexOf(n)>=0}))).length&&p(r[0].states);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(P,Object(_.a)(Object(_.a)({},{onFocus:b,onChange:t}),{},{disabled:!n,dataSource:u,placeholder:"Select a state"}))},L=n(474),N=n(476),M=function(e){var t=e.onCSVDataChange,n=Object(a.useContext)(v),c=n.fileService,s=n.csvService,i=function(){var e=Object(h.a)(l.a.mark((function e(n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return e.next=3,c.getFileContent(n);case 3:r=e.sent,a=s.parseCSV(r),t(null===a||void 0===a?void 0:a.map((function(e){return{name:e[0],story_type:e[1],estimate:parseInt(e[2]),description:e[3]}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsx)(L.a,{name:"file",multiple:!1,showUploadList:!1,beforeUpload:function(e){return i(e),!1},children:Object(r.jsx)(x.a,{type:"primary",icon:Object(r.jsx)(N.a,{}),children:"Upload CSV file"})})},W=n(217),J=n.n(W),H=function(e){var t=e.dataSource;return Object(r.jsx)(J.a,{dataSource:t.map((function(e,t){return Object(_.a)(Object(_.a)({},e),{},{key:t})})),columns:K,pagination:!1})},K=[{title:"Name",dataIndex:"name",key:"name"},{title:"Story type",dataIndex:"story_type",key:"story_type"},{title:"Estimation",dataIndex:"estimate",key:"estimate"},{title:"Description",dataIndex:"description",key:"description"}],z=function(){var e=Object(a.useContext)(v).clubhouseService,t=Object(a.useState)(),n=Object(o.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(),u=Object(o.a)(i,2),p=u[0],b=u[1],j=Object(a.useState)(),d=Object(o.a)(j,2),f=d[0],g=d[1],m=Object(a.useState)(),y=Object(o.a)(m,2),S=y[0],k=y[1],w=Object(a.useState)(),T=Object(o.a)(w,2),_=T[0],I=T[1],A=Object(a.useState)(),R=Object(o.a)(A,2),F=R[0],P=R[1],L=Object(a.useState)([]),N=Object(o.a)(L,2),W=N[0],J=N[1],K=Object(a.useState)(!1),z=Object(o.a)(K,2),G=z[0],Q=z[1],X=function(){var t=Object(h.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c){t.next=3;break}return console.error("Please select an project before creating stories"),t.abrupt("return");case 3:return Q(!0),n=W.map((function(e){var t=e.name,n=e.story_type,r=e.estimate,a=e.description;return{name:t,story_type:n,estimate:r,project_id:c,epic_id:S,description:a,workflow_state_id:p,iteration_id:_,requested_by_id:F}})),t.next=7,e.createStories(n);case 7:Q(!1);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(C,{}),Object(r.jsx)("div",{children:Object(r.jsxs)(O.b,{style:{marginBottom:16,marginTop:16},children:[Object(r.jsx)(V,{onChange:function(e){s(parseInt(e.toString()))}}),Object(r.jsx)(D,{onChange:function(e){b(parseInt(e.toString()))},projectId:c})]})}),Object(r.jsx)("div",{children:Object(r.jsxs)(O.b,{style:{marginBottom:16},children:[Object(r.jsx)(E,{onChange:function(e){g(parseInt(e.toString()))}}),Object(r.jsx)(q,{onChange:function(e){k(parseInt(e.toString()))},selectedMilestoneId:f}),Object(r.jsx)(B,{onChange:function(e){I(parseInt(e.toString()))}})]})}),Object(r.jsx)("div",{children:Object(r.jsx)(O.b,{style:{marginBottom:16},children:Object(r.jsx)(U,{onChange:function(e){P(e.toString())}})})}),Object(r.jsx)("div",{style:{marginBottom:16,textAlign:"right",width:"100%"},children:Object(r.jsx)(M,{onCSVDataChange:J})}),Object(r.jsx)(H,{dataSource:W}),Object(r.jsx)("div",{style:{marginTop:16,textAlign:"right",width:"100%"},children:Object(r.jsx)(x.a,{disabled:W.length<=0,type:"primary",onClick:X,loading:G,children:"Create Stories"})})]})},G=n(223),Q=n(477),X=y.a.Title,Y=y.a.Link,Z=function(e){var t=e.onTokenChanged,n=Object(a.useState)(""),c=Object(o.a)(n,2),s=c[0],i=c[1];return Object(r.jsxs)("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column"},children:[Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:80,marginBottom:80},children:Object(r.jsxs)(y.a,{style:{width:800,textAlign:"center"},children:[Object(r.jsx)(X,{children:"Welcome to Clubhouse CSV Uploader"}),Object(r.jsxs)(X,{level:5,children:["To use the CSV Uploader we need you to generate a Clubhouse API Token and to pass it in the Token Value input. Please see this page"," ",Object(r.jsx)(Y,{target:"blank",href:"https://help.clubhouse.io/hc/en-us/articles/205701199-Clubhouse-API-Tokens",children:"Clubhouse API Tokens"})," ","for more details on how to generate a token"]})]})}),Object(r.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(r.jsxs)("div",{style:{width:600,display:"flex"},children:[Object(r.jsx)(Q.a,{autoFocus:!0,size:"large",onChange:function(e){i(e.target.value)},value:s}),Object(r.jsx)(x.a,{type:"primary",size:"large",style:{marginLeft:8},onClick:function(e){s.length<=0?G.b.error("Add a valid token"):t(s)},children:"Continue"})]})})]})};var $=function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"/clubhouse-csv-upload",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_CLUBHOUSE_API_TOKEN,t=function(e,t){var n=Object(a.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.error(r),t}})),r=Object(o.a)(n,2),c=r[0],s=r[1];return[c,function(t){try{s(t),window.localStorage.setItem(e,JSON.stringify(t))}catch(n){console.error(n)}}]}("clubhouseApiToken",e),n=Object(o.a)(t,2),c=n[0],s=n[1];if(e&&s(e),!c)return Object(r.jsx)(Z,{onTokenChanged:s});var i={clubhouseService:new j(c),fileService:new f,csvService:new d,setClubhouseApiToken:s};return Object(r.jsx)(v.Provider,{value:i,children:Object(r.jsx)("div",{className:"App",children:Object(r.jsx)(z,{})})})};i.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)($,{})}),document.getElementById("root"))}},[[467,1,2]]]);
//# sourceMappingURL=main.89f472d1.chunk.js.map